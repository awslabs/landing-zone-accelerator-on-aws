// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`GuardDutyMalwareStack > Construct(SecurityGuardDutyMalwareStack):  Snapshot Test 1`] = `
{
  "Resources": {
    "MalwareProtectionPlanAwsAcceleratorFirewallConfig694700707723UsEast1MalwareProtectionPlanD896CA2E": {
      "DependsOn": [
        "MalwareProtectionRoleDefaultPolicy64ED1BBE",
        "MalwareProtectionRole5B1F41FB",
      ],
      "Properties": {
        "Actions": {
          "Tagging": {
            "Status": "ENABLED",
          },
        },
        "ProtectedResource": {
          "S3Bucket": {
            "BucketName": "aws-accelerator-firewall-config-694700707723-us-east-1",
          },
        },
        "Role": {
          "Fn::GetAtt": [
            "MalwareProtectionRole5B1F41FB",
            "Arn",
          ],
        },
        "Tags": [
          {
            "Key": "data-classification",
            "Value": "high",
          },
          {
            "Key": "network",
            "Value": "firewall",
          },
        ],
      },
      "Type": "AWS::GuardDuty::MalwareProtectionPlan",
    },
    "MalwareProtectionRole5B1F41FB": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "GuardDuty Malware Protection requires a wildcard for KMS and CreateMalwareProtectionPlan API calls.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Condition": {
                "ArnLike": {
                  "aws:SourceArn": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition",
                        },
                        ":guardduty:us-east-1:555555555555:malware-protection-plan/*",
                      ],
                    ],
                  },
                },
                "StringEquals": {
                  "aws:SourceAccount": "555555555555",
                },
              },
              "Effect": "Allow",
              "Principal": {
                "Service": "malware-protection-plan.guardduty.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "RoleName": "AWSAccelerator-GuardDutyS3MalwareScanRole-us-east-1",
      },
      "Type": "AWS::IAM::Role",
    },
    "MalwareProtectionRoleDefaultPolicy64ED1BBE": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "GuardDuty Malware Protection requires a wildcard for KMS and CreateMalwareProtectionPlan API calls.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "GuardDuty Malware Protection requires a wildcard for KMS API calls.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "events:DeleteRule",
                "events:PutRule",
                "events:PutTargets",
                "events:RemoveTargets",
              ],
              "Condition": {
                "StringEquals": {
                  "events:ManagedBy": "malware-protection-plan.guardduty.amazonaws.com",
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":events:us-east-1:555555555555:rule/DO-NOT-DELETE-AmazonGuardDutyMalwareProtectionS3*",
                  ],
                ],
              },
              "Sid": "AllowManagedRuleToSendS3EventsToGuardDuty",
            },
            {
              "Action": [
                "events:DescribeRule",
                "events:ListTargetsByRule",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":events:us-east-1:555555555555:rule/DO-NOT-DELETE-AmazonGuardDutyMalwareProtectionS3*",
                  ],
                ],
              },
              "Sid": "AllowGuardDutyToMonitorEventBridgeManagedRule",
            },
            {
              "Action": "guardduty:CreateMalwareProtectionPlan",
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "AllowGuardDutyCreateMalwareProtectionPlan",
            },
            {
              "Action": "iam:PassRole",
              "Condition": {
                "StringEquals": {
                  "iam:PassedToService": "malware-protection-plan.guardduty.amazonaws.com",
                },
              },
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "MalwareProtectionRole5B1F41FB",
                  "Arn",
                ],
              },
              "Sid": "IamPassRole",
            },
            {
              "Action": [
                "kms:GenerateDataKey",
                "kms:Decrypt",
              ],
              "Condition": {
                "StringLike": {
                  "kms:ViaService": "s3.us-east-1.amazonaws.com",
                },
              },
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "AllowDecryptForMalwareScan",
            },
            {
              "Action": "s3:PutObject",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":s3:::aws-accelerator-firewall-config-694700707723-us-east-1/malware-protection-resource-validation-object",
                  ],
                ],
              },
              "Sid": "AllowPutValidationObject",
            },
            {
              "Action": [
                "s3:PutBucketNotification",
                "s3:GetBucketNotification",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":s3:::aws-accelerator-firewall-config-694700707723-us-east-1",
                  ],
                ],
              },
              "Sid": "AllowEnableS3EventBridgeEvents",
            },
            {
              "Action": [
                "s3:GetObjectTagging",
                "s3:GetObjectVersionTagging",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":s3:::aws-accelerator-firewall-config-694700707723-us-east-1/*",
                  ],
                ],
              },
              "Sid": "AllowPostScanTag",
            },
            {
              "Action": [
                "s3:ListBucket",
                "s3:GetBucketPolicy",
                "s3:GetBucketAcl",
                "s3:GetBucketLocation",
                "s3:GetBucketVersioning",
                "s3:GetBucketTagging",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":s3:::aws-accelerator-firewall-config-694700707723-us-east-1",
                  ],
                ],
              },
              "Sid": "AllowCheckBucketOwnership",
            },
            {
              "Action": [
                "s3:GetObject",
                "s3:GetObjectVersion",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":s3:::aws-accelerator-firewall-config-694700707723-us-east-1/*",
                  ],
                ],
              },
              "Sid": "AllowMalwareScan",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "MalwareProtectionRoleDefaultPolicy64ED1BBE",
        "Roles": [
          {
            "Ref": "MalwareProtectionRole5B1F41FB",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "SsmParamAcceleratorVersionFF83282D": {
      "Properties": {
        "Name": "/accelerator/AWSAccelerator-SecurityGuardDutyS3MalwareStack-555555555555-us-east-1/version",
        "Type": "String",
        "Value": "1.15.0-rc.2",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "SsmParamStackId521A78D3": {
      "Properties": {
        "Name": "/accelerator/AWSAccelerator-SecurityGuardDutyS3MalwareStack-555555555555-us-east-1/stack-id",
        "Type": "String",
        "Value": {
          "Ref": "AWS::StackId",
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
  },
}
`;
